-- CREACIÓN DE CLIENTES, PRODUCTOS Y VENTAPROD
-- ANTES DE CREAR CADA TABLA LA BORRAMOS

DROP TABLE CLIENTES CASCADE CONSTRAINTS; 

CREATE TABLE CLIENTES (
   NIF       VARCHAR2(10) NOT NULL,
   NOMBRE    VARCHAR(14), 
   LOCALIDAD VARCHAR(14),
   CONSTRAINT PK_CLIEN PRIMARY KEY (NIF) 
); 

INSERT INTO CLIENTES VALUES ('7114B','JUAN GÓMEZ','SEVILLA');
INSERT INTO CLIENTES VALUES ('7871A','PEDRO GARCÍA','MADRID');
INSERT INTO CLIENTES VALUES ('9871H','JULIA MENA','BARCELONA');
INSERT INTO CLIENTES VALUES ('8554L','ROSA MUÑOZ','BILBAO');
INSERT INTO CLIENTES VALUES ('5554M','PEPA LÓPEZ','BILBAO');
INSERT INTO CLIENTES VALUES ('4554J','PEPE PINTO','TOLEDO');
INSERT INTO CLIENTES VALUES ('4675J','ALBERT MUNT','MADRID');

-- ------------------------------------------------------------

DROP TABLE PRODUCTOS CASCADE CONSTRAINTS; 

CREATE TABLE PRODUCTOS (
   COD_PRODUCTO    NUMBER(4) NOT NULL,
   DESCRIPCION     VARCHAR2(20) NOT NULL,
   LINEA_PRODUCTO  VARCHAR(10)  ,
   PRECIO          NUMBER(4) ,
   CONSTRAINT PK_PRODUCT PRIMARY KEY (COD_PRODUCTO)
);

INSERT INTO PRODUCTOS VALUES (12,'MESAS CAMILLA','SUPER',600);
INSERT INTO PRODUCTOS VALUES (14,'SILLA RUEDAS','SUPER',800);
INSERT INTO PRODUCTOS VALUES (13,'ESTUCHE MESA','EXTRA',7);
INSERT INTO PRODUCTOS VALUES (16,'PORTAFOLIOS','NORMAL',3);
INSERT INTO PRODUCTOS VALUES (18,'RATONES','OFIMÁTICA',2);
INSERT INTO PRODUCTOS VALUES (21,'DISQUETES','OFIMÁTICA',1);
INSERT INTO PRODUCTOS VALUES (24,'ROTULADORES','ESCRITORIO',4);
INSERT INTO PRODUCTOS VALUES (27,'PLUMAS','ESCRITORIO',3);
INSERT INTO PRODUCTOS VALUES (30,'ESTUCHE GAFAS','EXTRA',8);
INSERT INTO PRODUCTOS VALUES (31,'ETIQUETAS','NORMAL',2);
INSERT INTO PRODUCTOS VALUES (33,'ALTAVOCES','OFIMÁTICA',3);
INSERT INTO PRODUCTOS VALUES (34,'FOLIOS A4','SUPER',1);
INSERT INTO PRODUCTOS VALUES (37,'RELOJ MESA','ESCRITORIO',5);
-- --------------------------------------------------------

DROP TABLE VENTAPROD CASCADE CONSTRAINTS; 

CREATE TABLE VENTAPROD (
    NIF             VARCHAR2(10) NOT NULL,
    COD_PRODUCTO    NUMBER(4) NOT NULL,
    UNIDADES        NUMBER(4) NOT NULL,
    FECHA           DATE,
    CONSTRAINT FK_NIF 
      FOREIGN KEY (NIF) REFERENCES CLIENTES,
    CONSTRAINT FK_COD_PRODUCTO 
      FOREIGN KEY  (COD_PRODUCTO) REFERENCES PRODUCTOS
 );


-- SE CAMBIA EL FORMATO DE LA FECHA PARA QUE ALMACENE BIEN EL AÑO. 

ALTER SESSION SET NLS_DATE_FORMAT = 'DD/MM/YYYY';
 
INSERT INTO VENTAPROD VALUES ('7114B',12,5,'21/01/2005');
INSERT INTO VENTAPROD VALUES ('7114B',12,10,'11/02/2005');
INSERT INTO VENTAPROD VALUES ('7114B',12,5,'12/03/2005');
INSERT INTO VENTAPROD VALUES ('7871A',12,5,'21/01/2005');
INSERT INTO VENTAPROD VALUES ('9871H',12,10,'21/01/2005');
INSERT INTO VENTAPROD VALUES ('8554L',12,15,'20/01/2005');
INSERT INTO VENTAPROD VALUES ('8554L',12,15,'10/03/2005');
INSERT INTO VENTAPROD VALUES ('8554L',12,15,'12/02/2005');
INSERT INTO VENTAPROD VALUES ('5554M',12,7,'11/01/2005');
INSERT INTO VENTAPROD VALUES ('4554J',12,10,'12/01/2005');
INSERT INTO VENTAPROD VALUES ('4675J',12,20,'14/01/2005');
INSERT INTO VENTAPROD VALUES ('4675J',12,10,'12/02/2005');
INSERT INTO VENTAPROD VALUES ('4675J',12,2,'10/03/2005');

INSERT INTO VENTAPROD VALUES ('7114B',14,50,'21/03/2005');
INSERT INTO VENTAPROD VALUES ('7871A',14,15,'20/01/2005');
INSERT INTO VENTAPROD VALUES ('7871A',14,25,'27/02/2005');
INSERT INTO VENTAPROD VALUES ('7871A',14,10,'24/03/2005');
INSERT INTO VENTAPROD VALUES ('9871H',14,15,'23/01/2005');
INSERT INTO VENTAPROD VALUES ('8554L',14,10,'29/01/2005');
INSERT INTO VENTAPROD VALUES ('5554M',16,12,'21/01/2005');
INSERT INTO VENTAPROD VALUES ('4554J',16,15,'24/01/2005');
INSERT INTO VENTAPROD VALUES ('4554J',16,10,'12/02/2005');
INSERT INTO VENTAPROD VALUES ('4554J',16,5,'15/03/2005');
INSERT INTO VENTAPROD VALUES ('4675J',16,10,'20/01/2005');
INSERT INTO VENTAPROD VALUES ('7114B',16,2,'21/01/2005');


INSERT INTO VENTAPROD VALUES ('7871A',30,10,'21/01/2005');
INSERT INTO VENTAPROD VALUES ('9871H',30,4,'21/01/2005');
INSERT INTO VENTAPROD VALUES ('8554L',21,5,'21/01/2006');
INSERT INTO VENTAPROD VALUES ('5554M',21,5,'21/01/2006');
INSERT INTO VENTAPROD VALUES ('4554J',33,5,'21/01/2006');
INSERT INTO VENTAPROD VALUES ('4675J',33,5,'21/01/2006');
INSERT INTO VENTAPROD VALUES ('4675J',33,10,'11/02/2006');

INSERT INTO VENTAPROD VALUES ('4675J',37,10,'11/02/2006');
INSERT INTO VENTAPROD VALUES ('7871A',37,10,'21/01/2005');
INSERT INTO VENTAPROD VALUES ('9871H',27,4,'1/01/2005');
INSERT INTO VENTAPROD VALUES ('8554L',27,10,'3/02/2006');
INSERT INTO VENTAPROD VALUES ('8554L',27,2,'13/01/2006');
INSERT INTO VENTAPROD VALUES ('8554L',27,5,'30/03/2006');
INSERT INTO VENTAPROD VALUES ('5554M',27,5,'21/03/2006');
INSERT INTO VENTAPROD VALUES ('4554J',34,5,'11/01/2006');
INSERT INTO VENTAPROD VALUES ('4554J',34,10,'18/02/2006');
INSERT INTO VENTAPROD VALUES ('4675J',34,5,'12/01/2006');
INSERT INTO VENTAPROD VALUES ('4675J',34,10,'11/02/2006');

-- SE DEJA LA FECHA COMO ESTABA.

ALTER SESSION SET NLS_DATE_FORMAT = 'DD/MM/YY';

Commit;

-- ************ BORRAMOS LAS TABLAS POR SI EXISTEN
-- TABLAS LIBROS, SOCIOS Y PRESTAMOS.

DROP TABLE LIBROS CASCADE CONSTRAINTS; 
DROP TABLE SOCIOS CASCADE CONSTRAINTS; 
DROP TABLE PRESTAMO CASCADE CONSTRAINTS; 

-- ************ CREACIÓN DE TABLAS: *********************

CREATE TABLE LIBROS
( COD_LIBRO VARCHAR2(10) PRIMARY KEY,
  TITULO VARCHAR2(35),
  AUTOR VARCHAR2(30),
  TEMA VARCHAR2(15),
  UNIDADES NUMBER(3)
) ;
-----------------------------------------------------------------

CREATE TABLE SOCIOS
( COD_SOCIO  NUMBER(6) PRIMARY KEY,
  NOMBRE VARCHAR2(30),
  DIRECCION VARCHAR2(30),
  PROVINCIA VARCHAR2(15),
  TLF NUMBER(9)
);
------------------------------------------------------------------
CREATE  TABLE PRESTAMO
(
  COD_SOCIO NUMBER(6),
  COD_LIBRO VARCHAR2(10),
  FECHA_PRESTAMO DATE, 
  CONSTRAINT PK_PRESTAMO PRIMARY KEY(COD_SOCIO, COD_LIBRO),
  CONSTRAINT FK1_PRESTAMO FOREIGN KEY(COD_LIBRO) REFERENCES LIBROS,
  CONSTRAINT FK2_PRESTAMO FOREIGN KEY(COD_SOCIO) REFERENCES SOCIOS
);

-----------------------------------------------------------------
--------------- LLENAR LIBROS: -------------------------------
INSERT INTO LIBROS VALUES('IG-110','GUÍA DE MICROSOFT WORKS 3','HARLEY HAHN','WORKS',6);
INSERT INTO LIBROS VALUES('IG-111','MICROSOFT WORKS 3','JOANNE WOODCOCK','WORKS',4);
INSERT INTO LIBROS VALUES('IG-112','MANUAL DE BORLAND C++ 4.0','ANGULO, JOSÉ MARÍA','LENGUAJE C',10);
INSERT INTO LIBROS VALUES('IG-113','MICROPROCESADORES 32 BITS','ANGULO, JOSÉ MARÍA','ARQUITECTURA',5);
INSERT INTO LIBROS VALUES('IG-114','COMPUTADORAS 5ª GENERACIÓN','BISHOP, PETER','ARQUITECTURA',6);
INSERT INTO LIBROS VALUES('IG-115','LIBRO DE EXCEL 97','JOHN WALKENBACH','EXCEL',7);
INSERT INTO LIBROS VALUES('IG-116','EXCEL 4 PARA WINDOWS-(99%)','SUSANA LINARES','EXCEL',10);
INSERT INTO LIBROS VALUES('IG-117','APLIQUE TURBO C++','SCHILDT H.','LENGUAJE C',4);
INSERT INTO LIBROS VALUES('IG-118','PROGRAMACIÓN EN C++','ENRIQUE Y JOSÉ HERNÁNDEZ','LENGUAJE C',6);
INSERT INTO LIBROS VALUES('IG-119','PUESTA A PUNTO DE ORACLE','ABBEY, J COREY','ORACLE',5);
INSERT INTO LIBROS VALUES('IG-120','ORACLE 7. MANUAL DE REFERENCIA','GEORGE KOCH','ORACLE',8);
INSERT INTO LIBROS VALUES('IG-121','ORACLE GUÍA DE APRENDIZAJE 7','ABBEY, J COREY','ORACLE',9);
INSERT INTO LIBROS VALUES('IG-122','TÉCNICAS DE PROGRAMACIÓN','F. ALONSO','PROGRAMACIÓN',8);
INSERT INTO LIBROS VALUES('IG-123','METODOLOGÍA DE LA PROGRAMACIÓN','D. ALONSO Y S. RUMEU','PROGRAMACIÓN',5);
INSERT INTO LIBROS VALUES('IG-124','PROGRAMACIÓN ORIENTADA A OBJ','MORALES Y SEGOVIA','PROGRAMACIÓN',7);

-----------------------------------------------------------
------------ LLENAR SOCIOS: ---------------------------
INSERT INTO SOCIOS VALUES(200,'JUAN MARTÍNEZ','LA ALAMEDA 15','MADRID',9166766);
INSERT INTO SOCIOS VALUES(210,'PEDRO PÉREZ','LA HOSPEDERÍA, 5','TOLEDO',4586766);
INSERT INTO SOCIOS VALUES(220,'ANA GARCÍA','DEL HOSPITAL, 10','VALENCIA',9665766);
INSERT INTO SOCIOS VALUES(223,'JAVIER SÁNCHEZ','LOS BARRIOS S/N','TOLEDO',9256766);
INSERT INTO SOCIOS VALUES(226,'ALICIA MORALES','LA MARIPOSA 89','MADRID',9198766);
INSERT INTO SOCIOS VALUES(229,'JUANA LOPEZ','EL SALTAMONTES 315','MADRID',9716796);
INSERT INTO SOCIOS VALUES(230,'FRANCISCO PONCE','LA MARCHA, 21','MADRID',91445566);

-----------------------------------------------------------
------------ LLENAR PRÉSTAMO: ---------------------------
-- SE CAMBIA LA FECHA PARA ALMACENAR EL AÑO CORRECTAMENTE

ALTER SESSION SET NLS_DATE_FORMAT = 'DD/MM/YYYY';

INSERT INTO PRESTAMO VALUES(200,'IG-114','10/10/2005');
INSERT INTO PRESTAMO VALUES(200,'IG-117','16/10/2005');
INSERT INTO PRESTAMO VALUES(200,'IG-119','17/10/2005');

INSERT INTO PRESTAMO VALUES(210,'IG-115','8/10/2005');
INSERT INTO PRESTAMO VALUES(210,'IG-117','10/10/2005');
INSERT INTO PRESTAMO VALUES(210,'IG-120','12/10/2005');
INSERT INTO PRESTAMO VALUES(210,'IG-121','12/10/2005');

INSERT INTO PRESTAMO VALUES(223,'IG-116','15/10/2005');
INSERT INTO PRESTAMO VALUES(223,'IG-117','17/10/2005');

INSERT INTO PRESTAMO VALUES(226,'IG-114','13/10/2005');
INSERT INTO PRESTAMO VALUES(226,'IG-115','15/10/2005');

INSERT INTO PRESTAMO VALUES(229,'IG-115','17/10/2005');
INSERT INTO PRESTAMO VALUES(229,'IG-120','18/10/2005');
INSERT INTO PRESTAMO VALUES(229,'IG-122','18/10/2005');

INSERT INTO PRESTAMO VALUES(230,'IG-114','10/10/2005');
INSERT INTO PRESTAMO VALUES(230,'IG-118','17/10/2005');
INSERT INTO PRESTAMO VALUES(230,'IG-119','19/10/2005');
INSERT INTO PRESTAMO VALUES(230,'IG-123','20/10/2005');

-------------------------------------------------------------------
-- DEJAMOS LA FECHA EN EL FORMATO NORMAL.

ALTER SESSION SET NLS_DATE_FORMAT = 'DD/MM/YY';

Commit;
REM **************************************************************
REM ****************************    CUENTAS  ***********

DROP TABLE MOVIMCU_05;
DROP TABLE CUENTAS_05;

Create TABLE   CUENTAS_05(  
  NUM_CTA     NUMBER(5) ,
  NOMBRE_CTA  VARCHAR2(25),
  DIREC_CTA   VARCHAR2(25),
  SALDO_DEBE  NUMBER(10),
  SALDO_HABER NUMBER(10),
  CONSTRAINT PK_CU05 PRIMARY KEY (NUM_CTA)
);

CREATE TABLE  MOVIMCU_05(        
   NUM_CTA     NUMBER(5), 
   FECHA_MOV   DATE,
   TIPO_MOV    CHAR(1), 
   IMPORTE     NUMBER(10),
   CONSTRAINT FK_CU05 FOREIGN KEY (NUM_CTA) REFERENCES CUENTAS_05
);

REM CUENTAS_05  ****************************

INSERT INTO CUENTAS_05 VALUES(12345,'JUAN','TOLEDO', 0,0);
INSERT INTO CUENTAS_05 VALUES(12346,'PEDRO','TOLEDO', 0,0);
INSERT INTO CUENTAS_05 VALUES(12347, 'ANA','GUADALAJARA',0,0);
INSERT INTO CUENTAS_05 VALUES(23458, 'MANUEL','GUADALAJARA',0,0);
INSERT INTO CUENTAS_05 VALUES(23456, 'ANDRES','ALCALA',0,0);
INSERT INTO CUENTAS_05 VALUES(33334, 'ISABEL','MADRID', 0,0);
INSERT INTO CUENTAS_05 VALUES(33344, 'MARIA','MADRID', 0,0);


REM MOVIMCU_05  ****************************

INSERT INTO MOVIMCU_05 VALUES(33334, SYSDATE,'I', 1000); 
INSERT INTO MOVIMCU_05 VALUES(33334, SYSDATE-1,'I', 2000); 
INSERT INTO MOVIMCU_05 VALUES(33334, SYSDATE-2,'R', 100); 
INSERT INTO MOVIMCU_05 VALUES(33334, SYSDATE,'R', 5000); 

INSERT INTO MOVIMCU_05 VALUES(33344, SYSDATE,'R',200);
INSERT INTO MOVIMCU_05 VALUES(33344, SYSDATE-2,'I',200);

INSERT INTO MOVIMCU_05 VALUES(12345,SYSDATE -7, 'I',100);
INSERT INTO MOVIMCU_05 VALUES(12345,SYSDATE -5, 'R',200);
INSERT INTO MOVIMCU_05 VALUES(12345,SYSDATE -4, 'I',300);

INSERT INTO MOVIMCU_05 VALUES(12346,SYSDATE,'I',200);

INSERT INTO MOVIMCU_05 VALUES(12347,SYSDATE, 'R',198);

Commit;



REM CALCULO DE SALDOS ***************

UPDATE  CUENTAS_05 C SET SALDO_DEBE  = (SELECT NVL (SUM(IMPORTE),0) FROM MOVIMCU_05
WHERE TIPO_MOV='R' AND  C.NUM_CTA =NUM_CTA);

UPDATE  CUENTAS_05 C SET SALDO_HABER  = (SELECT NVL (SUM(IMPORTE),0) FROM MOVIMCU_05
WHERE TIPO_MOV='I'  AND C.NUM_CTA =NUM_CTA);

COMMIT;

REM *******************************************

DROP TABLE PERSO_15;
REM   TABLA PERSO_15  ******************************

create table PERSO_15 (
nombre varchar2(20) primary key,
sexo char(1),
casado char(1),
hijos char(1)
);

INSERT INTO PERSO_15 VALUES ('JUAN',   'H','S','S');
INSERT INTO PERSO_15 VALUES ('ALICIA', 'M','S','S');

INSERT INTO PERSO_15 VALUES ('ANA',    'M','S','N');

INSERT INTO PERSO_15 VALUES ('ANDRES', 'H','N','S');
INSERT INTO PERSO_15 VALUES ('SUSANA', 'M','N','S');

INSERT INTO PERSO_15 VALUES ('MANUEL', 'H','N','N');


COMMIT;

