
********TEMA 6*********



1. INSERT INTO EMPLE
SELECT 2000, 'SAVEDRA', OFICIO, DIR, SYSDATE, 
SALARIO*1.2, COMISION, DEPT_NO
FROM EMPLE WHERE APELLIDO = 'SALA';

2.INSERT INTO PROFESORES
SELECT DISTINCT COD_CENTRO, 8790055,
'Salas, Clara', 'IDIOMA'
FROM PERSONAL WHERE COD_CENTRO IN
(SELECT COD_CENTRO FROM PERSONAL
WHERE FUNCION = 'ADMINISTRATIVO'
GROUP BY COD_CENTRO HAVING COUNT(*) = 1);

3. INSERT INTO ARTICULOS
SELECT 'QUESO', COD_FABRICANTE, 1, 'Primera', 5, 2, 10
FROM FABRICANTES WHERE PAIS='FRANCIA';

4. SELECT DEPT_NO FROM EMPLE
WHERE OFICIO='EMPLEADO' GROUP BY DEPT_NO
HAVING COUNT (*)=
(SELECT MAX(COUNT(*)) FROM EMPLE WHERE OFICIO='EMPLEADO'
GROUP BY DEPT_NO))
WHERE APELLIDO ='SAVEDRA';

5.SELECT DEPT_NO FROM EMPLE
WHERE OFICIO='EMPLEADO' GROUP BY DEPT_NO
HAVING COUNT (*)=
(SELECT MAX(COUNT(*)) FROM EMPLE WHERE OFICIO='EMPLEADO'
GROUP BY DEPT_NO));

6. UPDATE TIENDAS
SET (NOMBRE, DIRECCION, POBLACION, PROVINCIA, CODPOSTAL)=(SELECT NOMBRE, 
DIRECCION, POBLACION, PROVINCIA, CODPOSTAL  FROM TIENDAS
WHERE NIF='2222-A')
WHERE NIF='1111-A';

7.UPDATE ARTICULOS
SET CATEGORIA = 'Segunda'
WHERE (COD_FABRICANTE, CATEGORIA) IN (SELECT COD_FABRICANTE, CATEGORIA
FROM ARTICULOS WHERE CATEGORIA='Primera' AND COD_FABRICANTE= (SELECT
COD_FABRICANTE FROM FABRICANTES WHERE PAIS = 'ITALIA'));

8.UPDATE PEDIDOS P
SET UNIDADES_PEDIDAS=(SELECT EXISTENCIAS*0.2 FROM ARTICULOS
WHERE ARTICULO=P.ARTICULO AND
COD_FABRICANTE=P.COD_FABRICANTE AND PESO=P.PESO AND
CATEGORIA=P.CATEGORIA)
WHERE UNIDADES_PEDIDAS > (SELECT EXISTENCIAS FROM ARTICULOS
WHERE ARTICULO=P.ARTICULO AND COD_FABRICANTE=P.COD_FABRICANTE AND PESO=P.PESO AND
CATEGORIA=P.CATEGORIA)



Ejercicio 1 pág: 181

UPDATE CENTROS SET NUM_PLAZAS=TRUNC (NUM_PLAZAS/2)
WHERE COD_CENTRO IN (SELECT COD_CENTRO FROM PROFESORES
GROUP BY COD_CENTRO
HAVING COUNT(*) <2);



Ejercicio 2 pag: 181

DELETE FROM CENTROS WHERE COD_CENTRO NOT IN (SELECT COD_CENTRO FROM PERSONAL);



Ejercicio 3 pag: 181

INSERT INTO PROFESORES 
SELECT DISTINCT COD_CENTRO, 123, 'Salas, Clara', 'IDIOMA'
FROM CENTROS
WHERE COD_CENTRO IN ( SELECT COD_CENTRO FROM PERSONAL
WHERE FUNCION='ADMINISTRATIVO'
GROUP BY COD_CENTRO
HAVING COUNT(*)=1);

* (Otra forma de hacerlo)

INSERT INTO PROFESORES 
SELECT DISTINCT COD_CENTRO, 123, 'Salas, Clara', 'IDIOMA'
FROM PERSONAL
WHERE FUNCION='ADMINISTRATIVO'
GROUP BY COD_CENTRO
HAVING COUNT(*)=1);


Ejercicio 4 pag: 181

DELETE FROM PERSONAL
WHERE COD_CENTRO IN (sELECT COD_CENTRO FROM CENTROS WHERE
NUM_PLAZAS < 300)
AND COD_CENTRO IN (SELECT COD_CENTRO FROM PROFESORES
GROUP BY COD_CENTRO HAVING COUNT (*)<2);

Ejercicio 5 pag 181:

DELETE PROFESORES
WHERE DNI NOT IN (SELECT DNI FROM PERSONAL);

Ejercicio 6 pag 181: 

INSERT INTO ARTICULOS
SELECT 'Queso', COD_FABRICANTE, 1, 'Primera', 2, 1, 100
FROM FABRICANTES
WHERE PAIS='FRANCIA';

INSERT INTO PEDIDOS
SELECT NIF, 'Queso', 30, 1, 'Primera', SYSDATE, 5 
FROM TIENDAS;

Ejercicio 7 pag 181:

INSERT INTO PEDIDOS
SELECT '1111-A', ARTICULO, COD_FABRICANTE, PESO, CATEGORIA, SYSDATE, 20
FROM VENTAS
GROUP BY ARTICULO, COD_FABRICANTE, PESO, CATEGORIA
HAVING COUNT (*) = (SELECT MAX(COUNT (*)) FROM VENTAS
GROUP BY ARTICULO, COD_FABRICANTE, PESO, CATEGORIA);


Ejercicio 8 pag 181:

INSERT INTO TIENDAS
VALUES
('123-A', 'TIENDA1', 'CALLE1', 'MADRID', 'MADRID', 28005);

INSERT INTO PEDIDOS 
SELECT '123-A', ARTICULO, COD_FABRICANTE, PESO, CATEGORIA,
SYSDATE, 20 FROM ARTICULOS;


Ejercicio 9 pag 181:

INSERT INTO PEDIDOS
SELECT NIF, ARTICULO, COD_FABRICANTE, PESO, CATEGORIA, SYSDATE, 30
FROM ARTICULOS, TIENDAS
WHERE NIF IN (SELECT NIF FROM TIENDAS WHERE PROVINCIA='SEVILLA')
AND (ARTICULO, COD_FABRICANTE, PESO, CATEGORIA) IN (SELECT ARTICULO,
COD_FABRICANTE, PESO, CATEGORIA FROM ARTICULOS WHERE COD_FABRICANTE IN (SELECT COD_FABRICANTE 
FROM FABRICANTES WHERE NOMBRE='GALLO'));

Ejercicio 10 pag 181:

INSERT INTO VENTAS
SELECT NIF, ARTICULO, COD_FABRICANTE, PESO,
CATEGORIA, SYSDATE, 10
FROM TIENDAS, ARTICULOS
WHERE PROVINCIA = 'TOLEDO' AND
CATEGORIA = 'Primera';

Ejercicio 11 pag 181:

INSERT INTO PEDIDOS
SELECT DISTINCT '5555-B', ARTICULO,
COD_FABRICANTE, PESO, CATEGORIA, SYSDATE, 10
FROM VENTAS
GROUP BY ARTICULO, COD_FABRICANTE, PESO,
CATEGORIA
HAVING SUM(UNIDADES_VENDIDAS) > 30;

Ejercicio 12 pag 181:

UPDATE TIENDAS SET
(NOMBRE, DIRECCION, POBLACION,PROVINCIA, CODPOSTAL)=(SELECT NOMBRE, 
DIRECCION, POBLACION, PROVINCIA, CODPOSTAL FROM TIENDAS WHERE NIF='2222-A')

Ejercicio 15 pag 181:

DELETE FROM TIENDAS
WHERE NIF NOT IN (SELECT DISTINCT NIF FROM VENTAS);

Ejercicio 16 pag 181:

DELETE FROM ARTICULOS
WHERE (ARTICULO, COD_FABRICANTE, PESO, CATEGORIA) NOT IN
(SELECT DISTINCT ARTICULO, COD_FABRICANTE, PESO, CATEGORIA FROM VENTAS)
AND (ARTICULO, COD_FABRICANTE, PESO, CATEGORIA) NOT IN ( SELECT DISTINCT ARTICULO,
COD_FABRICANTE, PESO, CATEGORIA FROM PEDIDOS);

Ejercicio 17 pag 181:

DELETE FROM PEDIDOS
WHERE CATEGORIA = 'Primera'
AND COD_FABRICANTE IN (SELECT COD_FABRICANTE FROM
FABRICANTES WHERE PAIS='BELGICA')

Ejercico 18 pag 181:



Ejercicio 19 pag 181:

UPDATE PEDIDOS
SET UNIDADES_PEDIDAS = UNIDADES_PEDIDAS -1
WHERE NIF='5555-B'
AND FECHA_PEDIDO = (SELECT MAX (FECHA_PEDIDO) FROM PEDIDOS WHERE NIF = '5555-B')





********TEMA 7*********

Ejemmplo 1: (Crea tablas llamadas "CH_EDAD y PK_EMPLEADO")

CREATE TABLE EMPLEADO
(NOMBRE VARCHAR2(25) CONSTRAINT PK_EMPLEADO PRIMARY KEY,
EDAD NUMBER CONSTRAINT CH_EDAD CHECK (EDAD BETWEEN 18 AND 35),
COD_PROVINCIA NUMBER(2));

DROP TABLE EMPLEADO;
SELECT TABLE_NAME, CONSTRAINT_NAME, CONSTRAINT_TYPE
FROM DBA_CONSTRAINTS
WHERE TABLE_NAME='EMPLEADO';


PARA QUE APAREZCA LA TABLA FABRICANTES07: 

SELECT CONSTRAINT_NAME, CONSTRAINT_TYPE, TABLE_NAME,
SEARCH_CONDITION
FROM DBA_CONSTRAINTS
WHERE TABLE_NAME='FABRICANTES07';


Ejercicio propuesto en clase:

1- CREAR TABLA CON PK
2- INSERTAFILAS
3- ELIMINA LA COLUMNA DE LA PK SIN ELIMINAR LA RESTRICCION.


Otro ejercicio propuesto en clase, PARA ENTREGAR:

1-Crea las tablas FAB, ART, VENTAS, PED, TIENDAS.
2-Con las restricciones del ejercicio1 del tema 7
3-Crea las restricciones necesarias para que funcione (sobre todo restricciones)
4- Cargar registros.

ejemplo :


DROP TABLE VENTAS;
DROP TABLE PEDIDOS;
DROP TABLE TIENDAS;
DROP ""    ARTICULOS;
""   ""    FABRICANTES07;
CREATE fabricantes;
create articulos;
create tiendas;
create ventas;
create pedidos;

